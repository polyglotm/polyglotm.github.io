---
layout: post
title: "[MEANI-Stack] - #9 (Node & Express) 회원가입 API작성"
date: '2016-02-28T06:11:00.002-08:00'
author: Jaeyoung Lee
tags:
- Pet-Project
- "*MEANI-Stack"
modified_time: '2016-02-28T06:11:11.806-08:00'
thumbnail: https://2.bp.blogspot.com/-C9NbS--ZXQc/VtL4-Fna9nI/AAAAAAAADyg/4QKeHgMMFyo/s72-c/2016.%2B2.%2B28.%2B10-40-58.png
blogger_id: tag:blogger.com,1999:blog-5872989675159532416.post-4485447920453479791
blogger_orig_url: http://polyglot-m.blogspot.com/2016/02/meani-stack-9-node-express-api.html
---

<h2>[MEANI-Stack] - #9 (Node &amp; Express) 회원가입 API작성</h2><br /><br /><br />회원가입 API를 위해 유저 모델부터 정의합니다.<br /><br />제 생각에 당장 필요한 필드는 email, password, role 세가지이며<br />언제 생성 되었는지 알기위해 createdAt을 자동으로 추가 하기로 하고 모델을 작성했습니다.<br /><br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-C9NbS--ZXQc/VtL4-Fna9nI/AAAAAAAADyg/4QKeHgMMFyo/s1600/2016.%2B2.%2B28.%2B10-40-58.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="640" src="https://2.bp.blogspot.com/-C9NbS--ZXQc/VtL4-Fna9nI/AAAAAAAADyg/4QKeHgMMFyo/s640/2016.%2B2.%2B28.%2B10-40-58.png" width="432" /></a></div><br /><br />required는 인자를 필수로 설정하는것 입니다.<br />해당 인자가 없을경우 오류를 발생시킵니다.<br /><br />enum의경우 들어온 인자를 사전 설정된 값으로 제한시킵니다.<br /><br class="Apple-interchange-newline" />validate의 경우 들어온 인자값을 모델에서 검증하는 도구입니다.<br />route나 controller에서 작업해도 되지만 순수하게 모델에서 작업하였습니다.<br />validate 참고링크 :&nbsp;<a href="http://mongoosejs.com/docs/validation.html" target="_blank">http://mongoosejs.com/docs/validation.html</a><br /><br /><br /><br /><br /><br /><br /><br />생성도니 모델을 이용해서 controller에 아래와 같이 작업하였습니다.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-wkHhmvV3r5g/VtL5UqIqVfI/AAAAAAAADyk/2A8UjZMZxUs/s1600/2016.%2B2.%2B28.%2B10-42-20.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="640" src="https://3.bp.blogspot.com/-wkHhmvV3r5g/VtL5UqIqVfI/AAAAAAAADyk/2A8UjZMZxUs/s640/2016.%2B2.%2B28.%2B10-42-20.png" width="394" /></a></div><br /><br />create메소드는 파라미터로 넘어온 email이 기존에 존재하는지 count메소드를 통해 체크하고,<br />count값이 0일경우 회원가입을 진행하도록 하였습니다.<br /><br />list메소드는 경우 기존 find를 사용하였고<br />findUserByEmail 메소드는 리퀘스트의 파라미터로 오는 email로 찾도록 하였습니다.<br /><br /><br /><br /><br /><br /><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-R22hujgsW-M/VtL6NP15iOI/AAAAAAAADy0/v38wuYUF8yI/s1600/2016.%2B2.%2B28.%2B10-44-27.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="210" src="https://4.bp.blogspot.com/-R22hujgsW-M/VtL6NP15iOI/AAAAAAAADy0/v38wuYUF8yI/s640/2016.%2B2.%2B28.%2B10-44-27.png" width="640" /></a></div><br />라우터 구성은 위와같이 restful하게 접근하였고 delete는 만들지 않았습니다.<br />(나중에 필요하면 만들 예정)<br /><br /><br /><br /><br /><br /><br />작성한 내용들을 아래와 같이 각각 express.js와 mongoose.js에 등록합니다.<br /><br /><div class="separator" style="clear: both; text-align: center;"></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-FiE-HO9xdr0/VtL66AyB6uI/AAAAAAAADzA/Y5LY6QdJmn8/s1600/2016.%2B2.%2B28.%2B10-49-17.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="640" src="https://4.bp.blogspot.com/-FiE-HO9xdr0/VtL66AyB6uI/AAAAAAAADzA/Y5LY6QdJmn8/s640/2016.%2B2.%2B28.%2B10-49-17.png" width="572" /></a></div><br />model과 routes를 등록한것 이외에<br />express에 bodyParser.urlencloeded를 extended: false -&gt; true로 변경하였고<br />mongoose 디버깅을 위해<br />mongoose.set('dedub', true);를 추가하였습니다.<br /><br />만약 process.env.NODE_ENV에 대해 잘 모르겠다면 아래 링크된 글을 참고하세요<br /><br /><h2 style="background-color: white; color: #222222; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 22px; margin: 0px; position: relative;"><a href="http://polyglot-m.blogspot.kr/2016/02/nodejs-nodejs-processenvnodeenv-nodejs.html" target="_blank">[Node.js] Node.js 환경변수 process.env.NODE_ENV 에 대한 이해 및 사용 [Node.js] Understanding the Node.js and using environment variables process.env.NODE_ENV</a></h2><br /><br /><br /><br /><br /><br />postman으로 작성한 API를 테스트 해봅니다.<br /><br /><br />첫번째는 회원가입 비정상 케이스, password를 6자리만 입력해봅니다.<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-9Q0CuIDzsnQ/VtL7lj3NckI/AAAAAAAADzM/lm4UyTPC030/s1600/2016.%2B2.%2B28.%2B10-51-51.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="640" src="https://4.bp.blogspot.com/-9Q0CuIDzsnQ/VtL7lj3NckI/AAAAAAAADzM/lm4UyTPC030/s640/2016.%2B2.%2B28.%2B10-51-51.png" width="482" /></a></div><br />에러 메시지가 이쁘진 않지만 그럭저럭 잘 넘어오는군요<br /><br /><br /><br />두번째는 회원가입 정상케이스<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-YmqNEZT8lPg/VtL79W3_U0I/AAAAAAAADzQ/Jo0-ovYlkL4/s1600/2016.%2B2.%2B28.%2B10-53-21.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="572" src="https://3.bp.blogspot.com/-YmqNEZT8lPg/VtL79W3_U0I/AAAAAAAADzQ/Jo0-ovYlkL4/s640/2016.%2B2.%2B28.%2B10-53-21.png" width="640" /></a></div><br /><br /><br /><br /><br />회원가입된 유저를 호출 해봅니다.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-0ql7rFqNU98/VtL8Z6tPGQI/AAAAAAAADzY/TU7jY0bLeG0/s1600/2016.%2B2.%2B28.%2B10-55-30.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="352" src="https://1.bp.blogspot.com/-0ql7rFqNU98/VtL8Z6tPGQI/AAAAAAAADzY/TU7jY0bLeG0/s640/2016.%2B2.%2B28.%2B10-55-30.png" width="640" /></a></div><br /><br /><br />굿 제대로 넘어오네요<br /><br /><br /><br /><br />다음은 유저 리스트<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-Avod7IxP5e8/VtL8jetDxaI/AAAAAAAADzc/kQka0HCkbiU/s1600/2016.%2B2.%2B28.%2B10-54-34.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="640" src="https://4.bp.blogspot.com/-Avod7IxP5e8/VtL8jetDxaI/AAAAAAAADzc/kQka0HCkbiU/s640/2016.%2B2.%2B28.%2B10-54-34.png" width="474" /></a></div><br /><br />좋습니다 잘 넘어옵니다.<br />이상있는 데이터들은 validate를 하기 전 테스트 한 데이터들 입니다.<br /><br /><br /><br />mongoose 디버깅 되고있는 부분도 확인해봅니다.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-KJwnskokk4Y/VtL83RJV3cI/AAAAAAAADzk/kMpLvwaKDVk/s1600/2016.%2B2.%2B28.%2B10-57-23.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="334" src="https://2.bp.blogspot.com/-KJwnskokk4Y/VtL83RJV3cI/AAAAAAAADzk/kMpLvwaKDVk/s640/2016.%2B2.%2B28.%2B10-57-23.png" width="640" /></a></div><br /><br />잘나옵니다.<br /><br /><br /><br /><br /><br />작업의 마무리는 커밋!<br />github : <a href="https://github.com/polyglotm/PP-MEANI-stack-back-end" target="_blank">https://github.com/polyglotm/PP-MEANI-stack-back-end</a><br /><br />그리고 문서 업데이트!<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-rOE-IQWaqLs/VtL-j7n6OeI/AAAAAAAADz0/Ysr1MFI8C8E/s1600/2016.%2B2.%2B28.%2B11-01-11.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="442" src="https://1.bp.blogspot.com/-rOE-IQWaqLs/VtL-j7n6OeI/AAAAAAAADz0/Ysr1MFI8C8E/s640/2016.%2B2.%2B28.%2B11-01-11.png" width="640" /></a></div><br /><br /><br /><br /><br /><br />언제나 포스트의 마무리는 애자일 보드 확인 및 다음 태스크 선정입니다.<br /><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-XHDjvqbQrOE/VtL_dUNsFqI/AAAAAAAADz8/waVBtyaZLrA/s1600/2016.%2B2.%2B28.%2B11-07-46.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="256" src="https://4.bp.blogspot.com/-XHDjvqbQrOE/VtL_dUNsFqI/AAAAAAAADz8/waVBtyaZLrA/s640/2016.%2B2.%2B28.%2B11-07-46.png" width="640" /></a></div><div><br /></div><div><br /></div>이번 태스크를 진행하면서 절실하게 머리속을 맴돈것은<br />"유닛 테스트를 빨리 붙여야겠다" 였어요...<br /><br />API는 계속 늘어만 갈텐데 뭐 하나 바뀔때마다<br />손가락으로 클릭 클릭해서 포스트맨 날리려면 어휴... 끔직합니다...<br />그리하여 다음 태스크는&nbsp;<u style="font-weight: bold;">(Node &amp; Express) 회원가입 API Test</u><u><b> 작성</b></u> 으로 선정되었습니다.<br /><br /><br /><br />